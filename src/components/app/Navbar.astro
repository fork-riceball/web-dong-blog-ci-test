---
import Clickable from '@/components/app/Clickable.astro';
import Search from '@/components/preact/Search.jsx';

const mainNav = [
  {
    name: '首頁',
    url: '/',
  },
  {
    name: '關於',
    url: '/about',
  },
  {
    name: '文章',
    url: '/post',
  },
  {
    name: '分類',
    url: '/post/categories',
  },
];
---

<nav
  style="height: var(--mainNav-height)"
  class="before:backdrop-hack fixed bottom-0 left-0 z-50 w-full px-4 before:backdrop-blur-xl md:top-0"
>
  <div
    class="border-b-none flex h-full items-center justify-between border-t border-primary-900/40 dark:border-primary-50/40 md:border-b md:border-t-0"
  >
    <div class="flex w-full items-center gap-2 md:gap-4">
      <a title="網頁東東首頁" href="/" class="inline-flex whitespace-nowrap px-4 text-lg font-bold tracking-widest">
        <!-- Logo -->
        <svg
          width="40"
          height="40"
          fill="currentColor"
          xmlns="http://www.w3.org/2000/svg"
          xml:space="preserve"
          style="enable-background:new 0 0 40 40"
          viewBox="0 0 40 40"
          ><path
            d="m36.4 23.8-1.8-7.6c-.2-.7-.3-1.4-.5-2.1-.2-.8-.7-1.6-1.5-2L21.6 6c-1-.6-2.3-.6-3.3 0L7.4 12c-.8.4-1.3 1.2-1.5 2-.1.7-.3 1.4-.5 2.1l-1.8 7.6c-.2 1.3.3 2.4 1.4 3L17.9 34c1.3.7 2.8.7 4.1 0l13-7.3c1.1-.6 1.6-1.7 1.4-2.9z"
          ></path></svg
        >
        <!-- Logomark -->
        <svg
          class="hidden md:inline"
          width="120"
          height="40"
          fill="currentColor"
          xmlns="http://www.w3.org/2000/svg"
          xml:space="preserve"
          style="enable-background:new 0 0 120 40"
          viewBox="0 0 120 40"
          ><path
            d="M4.1 11.3h4l2.9 12 3.1-12h3.4l3.1 12h.2l2.9-12h4l-4.9 17.2h-3.5L16 17.2h-.1l-3.3 11.3H9L4.1 11.3zM27.6 22.1c0-4 2.5-6.7 6.3-6.7 3.4 0 6.1 2.2 6.1 6.6v1h-8.8c0 1.9 1.1 3.1 2.9 3.1 1.2 0 2.1-.5 2.5-1.5l3.3.2c-.5 2.4-2.7 4-5.9 4-3.9-.1-6.4-2.6-6.4-6.7zm9-1.4c0-1.5-1.1-2.7-2.6-2.7-1.6 0-2.7 1.2-2.8 2.7h5.4zM42.4 11.3H46v6.5h.1c.5-1.1 1.5-2.3 3.7-2.3 2.8 0 5.2 2.2 5.2 6.6 0 4.3-2.3 6.7-5.2 6.7-2.1 0-3.2-1.2-3.7-2.3h-.2v2.1h-3.5V11.3zm6.2 14.6c1.8 0 2.7-1.6 2.7-3.8 0-2.2-.9-3.8-2.7-3.8-1.7 0-2.7 1.5-2.7 3.8s1 3.8 2.7 3.8zM57.4 28.5V11.3h6.2c5.2 0 8.4 3.2 8.4 8.6 0 5.4-3.2 8.6-8.4 8.6h-6.2zm6-3.1c3.2 0 4.9-1.7 4.9-5.5s-1.7-5.5-4.9-5.5h-2.3v11h2.3zM74 22.1c0-4 2.4-6.7 6.4-6.7s6.4 2.7 6.4 6.7-2.4 6.7-6.4 6.7-6.4-2.7-6.4-6.7zm9.1 0c0-2.3-.9-3.9-2.7-3.9-1.8 0-2.7 1.7-2.7 3.9s.9 3.9 2.7 3.9c1.8 0 2.7-1.7 2.7-3.9zM92.7 28.5h-3.6V15.6h3.4v2.3h.2c.6-1.5 2-2.4 3.9-2.4 2.7 0 4.5 1.9 4.5 4.9v8.2h-3.6V21c0-1.6-.9-2.5-2.3-2.5s-2.4 1-2.4 2.6v7.4zM103.7 30l3.3-.4c.3.8 1.1 1.5 2.7 1.5s2.7-.7 2.7-2.5v-2.4h-.2c-.5 1.1-1.6 2.1-3.7 2.1-2.9 0-5.2-2-5.2-6.3 0-4.4 2.4-6.6 5.2-6.6 2.2 0 3.2 1.3 3.7 2.3h.1v-2.2h3.6v13c0 3.3-2.6 5-6.3 5-3.5.1-5.5-1.5-5.9-3.5zm8.7-8c0-2.3-1-3.7-2.7-3.7-1.8 0-2.7 1.5-2.7 3.7s1 3.6 2.7 3.6c1.7 0 2.7-1.3 2.7-3.6z"
          ></path></svg
        >
      </a>
      <ul class="flex w-full justify-around font-medium md:justify-start">
        {
          mainNav.map((navbarLink) => (
            <li>
              <a href={navbarLink.url} class="p-2 md:p-4 ">
                {navbarLink.name}
              </a>
            </li>
          ))
        }
      </ul>
    </div>

    <Search client:media="(min-width: 1024px)" />

    <Clickable>
      <button
        transition:persist
        data-theme-toggle
        aria-label="網頁外觀樣式切換 Theme Toggle"
        type="button"
        class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 flex aspect-square w-16 items-center justify-center rounded-lg text-sm"
      >
        <!-- Dark Icon -->
        <svg
          width="16"
          height="16"
          class="hidden dark:block"
          fill="currentColor"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 1005 1005"
          ><path
            d="M502.5 0C225 0 0 225 0 502.5S225 1005 502.5 1005 1005 780 1005 502.5c0-25.7-2.2-51.4-5.6-75.9-54.7 76.5-144 126.2-245.7 126.2-166.4 0-301.5-135.1-301.5-301.5 0-101.1 49.7-191 126.2-245.7C553.9 2.2 528.2 0 502.5 0h0z"
          ></path></svg
        >

        <!-- Light Icon -->
        <svg
          width="16"
          height="16"
          fill="currentColor"
          class="dark:hidden"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 1005 1005"
          ><path
            d="M502.5 274.1c-126.1 0-228.4 102.3-228.4 228.4s102.3 228.4 228.4 228.4 228.4-102.3 228.4-228.4-102.3-228.4-228.4-228.4h0zM45.7 548.2H137c25.1 0 45.7-20.6 45.7-45.7s-20.6-45.7-45.7-45.7H45.7C20.6 456.8 0 477.4 0 502.5s20.6 45.7 45.7 45.7zm822.3 0h91.4c25.1 0 45.7-20.6 45.7-45.7s-20.6-45.7-45.7-45.7H868c-25.1 0-45.7 20.6-45.7 45.7s20.5 45.7 45.7 45.7zM456.8 45.7V137c0 25.1 20.6 45.7 45.7 45.7s45.7-20.6 45.7-45.7V45.7c0-25.1-20.6-45.7-45.7-45.7s-45.7 20.6-45.7 45.7zm0 822.3v91.4c0 25.1 20.6 45.7 45.7 45.7s45.7-20.6 45.7-45.7V868c0-25.1-20.6-45.7-45.7-45.7s-45.7 20.5-45.7 45.7zM228 163.5c-17.8-17.8-47.1-17.8-64.4 0-17.8 17.8-17.8 47.1 0 64.4l48.4 48.4c17.8 17.8 47.1 17.8 64.4 0 17.4-17.8 17.8-47.1 0-64.4L228 163.5zm565 565.1c-17.8-17.8-47.1-17.8-64.4 0-17.8 17.8-17.8 47.1 0 64.4l48.4 48.4c17.8 17.8 47.1 17.8 64.4 0 17.8-17.8 17.8-47.1 0-64.4L793 728.6zM841.5 228c17.8-17.8 17.8-47.1 0-64.4-17.8-17.8-47.1-17.8-64.4 0L728.6 212c-17.8 17.8-17.8 47.1 0 64.4 17.8 17.4 47.1 17.8 64.4 0l48.5-48.4zM276.4 793c17.8-17.8 17.8-47.1 0-64.4-17.8-17.8-47.1-17.8-64.4 0L163.5 777c-17.8 17.8-17.8 47.1 0 64.4s47.1 17.8 64.4 0l48.5-48.4z"
          ></path></svg
        >
      </button>
    </Clickable>
  </div>
</nav>

<script>
  function isDark() {
    const isSystemPerferDark = !('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const isLocalStorageDark = localStorage.theme === 'dark';
    return isLocalStorageDark || isSystemPerferDark;
  }

  function setTheme() {
    if (isDark()) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }

  function toggleTheme() {
    if (isDark()) {
      localStorage.theme = 'light';
    } else {
      localStorage.theme = 'dark';
    }
  }

  function setupThemeToggler() {
    document.querySelector('[data-theme-toggle]')?.addEventListener('click', () => {
      toggleTheme();
      setTheme();
      window.dispatchEvent(new Event('updateTheme'));
    });
  }

  document.addEventListener('astro:after-swap', () => {
    setupThemeToggler();
    setTheme();
  });

  setTheme();
  setupThemeToggler();
</script>
