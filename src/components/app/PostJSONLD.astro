---
import { getEntry } from 'astro:content';

interface Props {
  headline: string;
  description: string;
  publishDate: Date;
  keywords: string[];
  articleSection: string;
  author: {
    nameTC: string;
    url: string;
  } | undefined;
}

const { headline, description, publishDate, keywords, author, articleSection } = Astro.props;
const mySite = await getEntry('character', 'my-site');
const me = await getEntry('character', 'me');

const defaultOrganization = {
  "@type": "Organization",
  "name": mySite.data.nameTC,
  "url": mySite.data.social.url
  }
const postAuthor = {
    "author": {
    "@type": "Person",
    "name": author?.nameTC,
    "url": author?.url,
  }
}

const defaultAuthor = {
  "author": {
    "@type": "Person",
    "name": me.data.nameTC,
    "url": me.data.social.url,
  }
}

const postSchema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "url": Astro.url,
  "headline": headline,
  "description": description,
  "keywords": keywords,
  /* the schema expects is ISO 8601 format. For Date that is yyyy-MM-dd */
  "datePublished": publishDate.toISOString().substring(0, 10),
  "publisher": defaultOrganization,
  "articleSection": articleSection,
  ...(author ? postAuthor : defaultAuthor),
};

---

<script type="application/ld+json" set:html={JSON.stringify(postSchema)} />