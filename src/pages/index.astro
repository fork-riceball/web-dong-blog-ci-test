---
import { getCollection } from 'astro:content';
import Base from '@/layouts/Base.astro';
import Card from '@/components/card/Card.astro';
import Hero from '@/components/app/Hero.astro';
import uniqolor from 'uniqolor';

const publishedPosts = await getCollection('post', (data) => !data.data.isDraft);
const categories = [...new Set(publishedPosts.map((post) => post.data.category).flat())].sort((a, b) =>
  a.localeCompare(b, 'en', { sensitivity: 'base' }),
);
const categoriesLists = categories.map((category) => ({
  type: category,
  posts: publishedPosts.filter((post) => post.data.category === category),
}));
---

<Base>
  <Hero
    title={`網頁東東用最<span class="text-secondary dark:text-secondary-light">親切簡單</span>的方式描述<br class="hidden lg:block">如何<span
    class="text-secondary dark:text-secondary-light">設計與架構網頁</span
  >`}
  />
  <section>
    <h2 class="sr-only">文章種類</h2>
    <div class="flex flex-wrap gap-4">
      <div class="mx-4 grid w-full grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
        {
          categoriesLists.map((categoriesList) => (
            <Card themeColor={uniqolor.random({ saturation: 90, lightness: [70, 90] }).color} class="group">
              <div class="mb-8 flex items-center justify-between">
                <h2 class="font-bold opacity-90 text-3xl group-hover:opacity-100 ">
                  <a href={`/post/categories/${categoriesList.type}`}>{categoriesList.type}</a>
                </h2>
                <span class="opacity-60 transition-opacity group-hover:opacity-100">
                  {categoriesList.posts.length} 篇文章
                </span>
              </div>

              <ul class=" flex flex-col gap-4">
                {categoriesList.posts.map(
                  (post, index) =>
                    index + 1 < 4 && (
                      <li class="group/list flex gap-8">
                        <time class="opacity-80 group-hover/list:opacity-100">
                          {post.data.publishDate
                            .toLocaleDateString('zh-TW', { year: 'numeric', month: '2-digit' })
                            .replace(/\//g, '-')}
                        </time>
                        <a
                          class="inline-block opacity-80 transition-opacity text-lg group-hover/list:opacity-100"
                          href={`post/${post.slug}`}
                        >
                          {post.data.titleTC}
                        </a>
                      </li>
                    ),
                )}
              </ul>
            </Card>
          ))
        }
      </div>
    </div>
  </section>
</Base>
