---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import Base from '@/layouts/Base.astro';
import PageBanner from '@/components/app/Hero.astro';
import CardGallery from '@/components/card/CardGallery.astro';
import PostCard from '@/components/card/PostCard.astro';

export interface Props {
  posts: CollectionEntry<'post'>;
  publishedPosts: CollectionEntry<'post'>[];
}

export async function getStaticPaths() {
  const publishedPosts = await getCollection('post', (data) => !data.data.isDraft);
  const tags = [...new Set(publishedPosts.map((post) => post.data.tags).flat())];
  return tags.map((tag) => [{ params: { slug: tag }, props: { publishedPosts } }]);
}
const { slug } = Astro.params;
const { publishedPosts } = Astro.props;
const avaliableCurrentTagPosts = publishedPosts.filter((post) => post.data.tags.includes(slug as string));
---

<Base title={`搜尋文章標籤：${slug}`} description={`搜尋文章標籤`}>
  <PageBanner title={`搜尋文章標籤：${slug}`} />
  <section class="px-4">
    <CardGallery>
      {
        avaliableCurrentTagPosts.map((post) => (
          <PostCard
            post={{
              slug: post.slug,
              featureIcon: post.data.featureIcon,
              titleTC: post.data.titleTC,
              excerpt: post.data.excerpt,
              publishDate: post.data.publishDate,
              themeColor: post.data.themeColor,
              tags: post.data.tags,
              category: post.data.category,
            }}
          />
        ))
      }
    </CardGallery>
  </section>
</Base>
